# WeSense Platform Configuration
# Copy this file to .env and fill in your values
# .env is gitignored and will not be committed

# ===========================================
# Deployment Persona
# ===========================================
# Which services to run on this host. Options:
#   contributor - Ingesters only (sends decoded data to remote MQTT hub)
#   station     - Full local stack (EMQX + ClickHouse + Ingesters + Respiro)
#   hub         - MQTT broker only (production mqtt.wesense.earth)
#   observer    - Map + ClickHouse (future, needs P2P data feed)
#   researcher  - ClickHouse + IPFS (future)
#   guardian    - IPFS pinning (future)
#
# Multiple profiles can be combined:
#   docker compose --profile contributor --profile observer up -d
#
# See Deployment_Personas.md for full details
# Use: docker compose --profile $COMPOSE_PROFILES up -d
COMPOSE_PROFILES=station

# ===========================================
# EMQX Dashboard
# ===========================================
# Default credentials: admin / public
# Change password on first login via the dashboard

# ===========================================
# TLS Configuration (hub persona)
# ===========================================
# Enable TLS listeners (requires certificates in ./certs/)
TLS_MQTT_ENABLED=false
TLS_WS_ENABLED=false

# Certificate paths (inside container)
TLS_CERTFILE=/opt/emqx/etc/certs/fullchain.pem
TLS_KEYFILE=/opt/emqx/etc/certs/privkey.pem

# ===========================================
# Timezone
# ===========================================
TZ=Pacific/Auckland

# ===========================================
# Network Configuration
# ===========================================
DOCKER_NETWORK=wesense-net

# ===========================================
# Ports
# ===========================================
# EMQX
PORT_MQTT_PLAIN=1883
PORT_MQTT_TLS=8883
PORT_WS_PLAIN=8083
PORT_WS_TLS=8084
PORT_DASHBOARD=18083

# ClickHouse
PORT_CLICKHOUSE_HTTP=8123
PORT_CLICKHOUSE_NATIVE=9000

# Respiro Map
PORT_RESPIRO=3000

# TTN Webhook (only used if TTN_WEBHOOK_ENABLED=true)
PORT_TTN_WEBHOOK=5000

# ===========================================
# ClickHouse Configuration
# ===========================================
CLICKHOUSE_HOST=clickhouse
CLICKHOUSE_PORT=8123
CLICKHOUSE_DB=wesense
CLICKHOUSE_USER=default
CLICKHOUSE_PASSWORD=

# Ingester batching
CLICKHOUSE_BATCH_SIZE=100
CLICKHOUSE_FLUSH_INTERVAL=10

# ===========================================
# MQTT Broker (EMQX)
# ===========================================
MQTT_HOST=emqx
MQTT_PORT=1883
MQTT_USER=
MQTT_PASSWORD=

# ===========================================
# Meshtastic Ingester
# ===========================================
# Mode: 'community' (local node, default) or 'public' (hub operators only)
# Community: receives from a local Meshtastic node pushing to EMQX
# Public: subscribes to mqtt.meshtastic.org (only run by 1-2 hub operators)
MESHTASTIC_MODE=community

# ===========================================
# WeSense Ingester
# ===========================================
# TTN webhook support (optional HTTP receiver for The Things Network)
TTN_WEBHOOK_ENABLED=false
TTN_WEBHOOK_PORT=5000

# ===========================================
# Home Assistant Ingester
# ===========================================
# Connection to Home Assistant instance
HA_URL=http://homeassistant.local:8123
HA_ACCESS_TOKEN=
# Friendly name prefix for device IDs (e.g., "livingroom")
HA_NODE_NAME=
# Set to true to skip ClickHouse writes (MQTT-only mode)
DISABLE_CLICKHOUSE=false

# ===========================================
# General Ingester Configuration
# ===========================================
# For 'contributor' persona connecting to remote hub:
# Override MQTT_HOST above, or set these output vars:
# WESENSE_OUTPUT_BROKER=mqtt.wesense.earth
# WESENSE_OUTPUT_PORT=8883

# Logging
DEBUG=false
LOG_LEVEL=INFO

# ===========================================
# Respiro Map Configuration
# ===========================================
MAP_CENTER_LAT=-36.848
MAP_CENTER_LNG=174.763
MAP_ZOOM_LEVEL=10

# ===========================================
# Container Images
# ===========================================
# Images are automatically built and pushed to GitHub Container Registry
# Override to use local builds or specific versions
INGESTER_MESHTASTIC_IMAGE=ghcr.io/wesense-earth/wesense-ingester-meshtastic:latest
INGESTER_WESENSE_IMAGE=ghcr.io/wesense-earth/wesense-ingester-wesense:latest
INGESTER_HA_IMAGE=ghcr.io/wesense-earth/wesense-ingester-homeassistant:latest
RESPIRO_IMAGE=ghcr.io/wesense-earth/wesense-respiro:latest

